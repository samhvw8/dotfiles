============================= test session starts ==============================
platform linux -- Python 3.14.0, pytest-8.4.2, pluggy-1.6.0 -- /home/linuxbrew/.linuxbrew/opt/python@3.14/bin/python3.14
cachedir: .pytest_cache
rootdir: /mnt/d/www/claudekit/claudekit-engineer/.claude/skills/ai-multimodal/scripts/tests
plugins: mock-3.15.1, anyio-4.11.0, cov-7.0.0
collecting ... collected 56 items

test_document_converter.py::TestDependencyCheck::test_check_all_dependencies_available PASSED [  1%]
test_document_converter.py::TestDependencyCheck::test_check_dependencies_missing PASSED [  3%]
test_document_converter.py::TestPDFPageExtraction::test_extract_single_page FAILED [  5%]
test_document_converter.py::TestPDFPageExtraction::test_extract_page_range FAILED [  7%]
test_document_converter.py::TestPDFPageExtraction::test_extract_pages_no_pypdf PASSED [  8%]
test_document_converter.py::TestPDFOptimization::test_optimize_pdf_success FAILED [ 10%]
test_document_converter.py::TestPDFOptimization::test_optimize_pdf_no_pypdf PASSED [ 12%]
test_document_converter.py::TestImageExtraction::test_extract_images_success FAILED [ 14%]
test_document_converter.py::TestImageExtraction::test_extract_images_no_dependencies PASSED [ 16%]
test_document_converter.py::TestMarkdownConversion::test_convert_markdown_success FAILED [ 17%]
test_document_converter.py::TestMarkdownConversion::test_convert_markdown_no_wkhtmltopdf FAILED [ 19%]
test_document_converter.py::TestMarkdownConversion::test_convert_markdown_no_markdown_lib PASSED [ 21%]
test_document_converter.py::TestHTMLConversion::test_convert_html_success PASSED [ 23%]
test_document_converter.py::TestHTMLConversion::test_convert_html_no_wkhtmltopdf PASSED [ 25%]
test_document_converter.py::TestIntegration::test_file_not_found PASSED  [ 26%]
test_document_converter.py::TestIntegration::test_check_dependencies_integration PASSED [ 28%]
test_gemini_batch_process.py::TestAPIKeyFinder::test_find_api_key_from_env PASSED [ 30%]
test_gemini_batch_process.py::TestAPIKeyFinder::test_find_api_key_not_found PASSED [ 32%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_audio_mime_types PASSED [ 33%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_image_mime_types PASSED [ 35%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_video_mime_types PASSED [ 37%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_document_mime_types PASSED [ 39%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_unknown_mime_type PASSED [ 41%]
test_gemini_batch_process.py::TestMimeTypeDetection::test_case_insensitive PASSED [ 42%]
test_gemini_batch_process.py::TestFileUpload::test_upload_file_success PASSED [ 44%]
test_gemini_batch_process.py::TestFileUpload::test_upload_video_with_processing PASSED [ 46%]
test_gemini_batch_process.py::TestFileUpload::test_upload_file_failed PASSED [ 48%]
test_gemini_batch_process.py::TestProcessFile::test_process_small_file_inline PASSED [ 50%]
test_gemini_batch_process.py::TestProcessFile::test_process_large_file_api PASSED [ 51%]
test_gemini_batch_process.py::TestProcessFile::test_process_file_error_handling FAILED [ 53%]
test_gemini_batch_process.py::TestBatchProcessing::test_batch_process_success PASSED [ 55%]
test_gemini_batch_process.py::TestBatchProcessing::test_batch_process_no_api_key PASSED [ 57%]
test_gemini_batch_process.py::TestBatchProcessing::test_batch_process_dry_run FAILED [ 58%]
test_gemini_batch_process.py::TestResultsSaving::test_save_results_json PASSED [ 60%]
test_gemini_batch_process.py::TestResultsSaving::test_save_results_csv PASSED [ 62%]
test_gemini_batch_process.py::TestResultsSaving::test_save_results_markdown PASSED [ 64%]
test_media_optimizer.py::TestFFmpegCheck::test_ffmpeg_installed PASSED   [ 66%]
test_media_optimizer.py::TestFFmpegCheck::test_ffmpeg_not_installed PASSED [ 67%]
test_media_optimizer.py::TestFFmpegCheck::test_ffmpeg_error FAILED       [ 69%]
test_media_optimizer.py::TestMediaInfo::test_get_video_info PASSED       [ 71%]
test_media_optimizer.py::TestMediaInfo::test_get_media_info_no_ffmpeg PASSED [ 73%]
test_media_optimizer.py::TestMediaInfo::test_get_media_info_error FAILED [ 75%]
test_media_optimizer.py::TestVideoOptimization::test_optimize_video_success PASSED [ 76%]
test_media_optimizer.py::TestVideoOptimization::test_optimize_video_no_ffmpeg PASSED [ 78%]
test_media_optimizer.py::TestVideoOptimization::test_optimize_video_no_info PASSED [ 80%]
test_media_optimizer.py::TestVideoOptimization::test_optimize_video_with_target_size PASSED [ 82%]
test_media_optimizer.py::TestVideoOptimization::test_optimize_video_with_resolution PASSED [ 83%]
test_media_optimizer.py::TestAudioOptimization::test_optimize_audio_success PASSED [ 85%]
test_media_optimizer.py::TestAudioOptimization::test_optimize_audio_no_ffmpeg PASSED [ 87%]
test_media_optimizer.py::TestImageOptimization::test_optimize_image_success FAILED [ 89%]
test_media_optimizer.py::TestImageOptimization::test_optimize_image_resize PASSED [ 91%]
test_media_optimizer.py::TestImageOptimization::test_optimize_image_rgba_to_jpg PASSED [ 92%]
test_media_optimizer.py::TestImageOptimization::test_optimize_image_no_pillow PASSED [ 94%]
test_media_optimizer.py::TestVideoSplitting::test_split_video_success FAILED [ 96%]
test_media_optimizer.py::TestVideoSplitting::test_split_video_short_duration PASSED [ 98%]
test_media_optimizer.py::TestVideoSplitting::test_split_video_no_ffmpeg PASSED [100%]

=================================== FAILURES ===================================
________________ TestPDFPageExtraction.test_extract_single_page ________________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1473: in get_original
    raise AttributeError(
E   AttributeError: <module 'document_converter' from '/mnt/d/www/claudekit/claudekit-engineer/.claude/skills/ai-multimodal/scripts/document_converter.py'> does not have the attribute 'PdfWriter'
________________ TestPDFPageExtraction.test_extract_page_range _________________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1473: in get_original
    raise AttributeError(
E   AttributeError: <module 'document_converter' from '/mnt/d/www/claudekit/claudekit-engineer/.claude/skills/ai-multimodal/scripts/document_converter.py'> does not have the attribute 'PdfWriter'
________________ TestPDFOptimization.test_optimize_pdf_success _________________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1473: in get_original
    raise AttributeError(
E   AttributeError: <module 'document_converter' from '/mnt/d/www/claudekit/claudekit-engineer/.claude/skills/ai-multimodal/scripts/document_converter.py'> does not have the attribute 'PdfWriter'
_______________ TestImageExtraction.test_extract_images_success ________________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1503: in __enter__
    original, local = self.get_original()
                      ^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1473: in get_original
    raise AttributeError(
E   AttributeError: <module 'document_converter' from '/mnt/d/www/claudekit/claudekit-engineer/.claude/skills/ai-multimodal/scripts/document_converter.py'> does not have the attribute 'Image'
_____________ TestMarkdownConversion.test_convert_markdown_success _____________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1487: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/pkgutil.py:473: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'document_converter' has no attribute 'markdown'
_________ TestMarkdownConversion.test_convert_markdown_no_wkhtmltopdf __________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1429: in patched
    with self.decoration_helper(patched,
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:141: in __enter__
    return next(self.gen)
           ^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1411: in decoration_helper
    arg = exit_stack.enter_context(patching)
          ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/contextlib.py:530: in enter_context
    result = _enter(cm)
             ^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1487: in __enter__
    self.target = self.getter()
                  ^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/pkgutil.py:473: in resolve_name
    result = getattr(result, p)
             ^^^^^^^^^^^^^^^^^^
E   AttributeError: module 'document_converter' has no attribute 'markdown'
_______________ TestProcessFile.test_process_file_error_handling _______________
test_gemini_batch_process.py:205: in test_process_file_error_handling
    assert 'API Error' in result['error']
E   assert 'API Error' in "[Errno 2] No such file or directory: 'test.jpg'"
________________ TestBatchProcessing.test_batch_process_dry_run ________________
test_gemini_batch_process.py:250: in test_batch_process_dry_run
    results = gbp.batch_process(
../gemini_batch_process.py:260: in batch_process
    sys.exit(1)
E   SystemExit: 1
----------------------------- Captured stdout call -----------------------------
Error: GEMINI_API_KEY not found
Set via: export GEMINI_API_KEY='your-key'
Or create .env file with: GEMINI_API_KEY=your-key
______________________ TestFFmpegCheck.test_ffmpeg_error _______________________
test_media_optimizer.py:35: in test_ffmpeg_error
    assert mo.check_ffmpeg() is False
           ^^^^^^^^^^^^^^^^^
../media_optimizer.py:26: in check_ffmpeg
    subprocess.run(['ffmpeg', '-version'],
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1175: in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1179: in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1234: in _execute_mock_call
    raise effect
E   Exception: Error
___________________ TestMediaInfo.test_get_media_info_error ____________________
test_media_optimizer.py:92: in test_get_media_info_error
    info = mo.get_media_info('test.mp4')
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
../media_optimizer.py:50: in get_media_info
    result = subprocess.run(cmd, capture_output=True, text=True, check=True)
             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1175: in __call__
    return self._mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1179: in _mock_call
    return self._execute_mock_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:1234: in _execute_mock_call
    raise effect
E   Exception: Error
______________ TestImageOptimization.test_optimize_image_success _______________
/home/linuxbrew/.linuxbrew/opt/python@3.14/lib/python3.14/unittest/mock.py:964: in assert_called_once
    raise AssertionError(msg)
E   AssertionError: Expected 'save' to have been called once. Called 0 times.

During handling of the above exception, another exception occurred:
test_media_optimizer.py:251: in test_optimize_image_success
    mock_img.save.assert_called_once()
E   AssertionError: Expected 'save' to have been called once. Called 0 times.
_________________ TestVideoSplitting.test_split_video_success __________________
test_media_optimizer.py:319: in test_split_video_success
    assert len(result) == 2
E   AssertionError: assert 3 == 2
E    +  where 3 = len(['chunks/input_chunk_1.mp4', 'chunks/input_chunk_2.mp4', 'chunks/input_chunk_3.mp4'])
=============================== warnings summary ===============================
../../../../../../../../../../home/linuxbrew/.linuxbrew/lib/python3.14/site-packages/google/genai/types.py:40
  /home/linuxbrew/.linuxbrew/lib/python3.14/site-packages/google/genai/types.py:40: DeprecationWarning: '_UnionGenericAlias' is deprecated and slated for removal in Python 3.17
    VersionedUnionType = Union[builtin_types.UnionType, _UnionGenericAlias]

../../../../../../../../../../home/linuxbrew/.linuxbrew/lib/python3.14/site-packages/google/genai/types.py:9952
  /home/linuxbrew/.linuxbrew/lib/python3.14/site-packages/google/genai/types.py:9952: PydanticDeprecatedSince212: Using `@model_validator` with mode='after' on a classmethod is deprecated. Instead, use an instance method. See the documentation at https://docs.pydantic.dev/2.12/concepts/validators/#model-after-validator. Deprecated in Pydantic V2.12 to be removed in V3.0.
    @model_validator(mode='after')  # type: ignore[arg-type]

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED test_document_converter.py::TestPDFPageExtraction::test_extract_single_page
FAILED test_document_converter.py::TestPDFPageExtraction::test_extract_page_range
FAILED test_document_converter.py::TestPDFOptimization::test_optimize_pdf_success
FAILED test_document_converter.py::TestImageExtraction::test_extract_images_success
FAILED test_document_converter.py::TestMarkdownConversion::test_convert_markdown_success
FAILED test_document_converter.py::TestMarkdownConversion::test_convert_markdown_no_wkhtmltopdf
FAILED test_gemini_batch_process.py::TestProcessFile::test_process_file_error_handling
FAILED test_gemini_batch_process.py::TestBatchProcessing::test_batch_process_dry_run
FAILED test_media_optimizer.py::TestFFmpegCheck::test_ffmpeg_error - Exceptio...
FAILED test_media_optimizer.py::TestMediaInfo::test_get_media_info_error - Ex...
FAILED test_media_optimizer.py::TestImageOptimization::test_optimize_image_success
FAILED test_media_optimizer.py::TestVideoSplitting::test_split_video_success
================== 12 failed, 44 passed, 2 warnings in 0.94s ===================
